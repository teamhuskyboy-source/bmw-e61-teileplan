<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BMW E61 525xd â€“ Teileliste</title>

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f2f2f2; }
header { background:#111; color:#fff; padding:20px; text-align:center; }

.container { padding:15px; }

input, select, button {
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button {
  background:#3b82f6;
  color:#fff;
  border:none;
}

.part {
  background:#3b82f6;
  color:#fff;
  padding:15px;
  border-radius:14px;
  margin-bottom:10px;
  position:relative;
}

.part small { display:block; opacity:.9; }

.star {
  position:absolute;
  right:15px;
  top:15px;
  font-size:18px;
  color:#facc15;
  cursor:pointer;
}

.details {
  background:#fff;
  color:#000;
  padding:12px;
  border-left:5px solid #3b82f6;
  border-radius:10px;
  margin-top:10px;
  display:none;
}
</style>
</head>

<body>

<header>
  <h1>BMW E61 525xd â€“ Teileliste</h1>
  <p>Suche, filtere oder fÃ¼ge neue Teile hinzu</p>
</header>

<div class="container">

  <label>VIN</label>
  <input id="vinInput" placeholder="VIN eingeben">

  <input id="search" placeholder="Teil suchen...">

  <select id="categoryFilter">
    <option value="">Alle Kategorien</option>
    <option>Motor</option>
    <option>Getriebe</option>
    <option>Abgasanlage</option>
    <option>KÃ¼hlsystem</option>
    <option>Kraftstoffsystem</option>
    <option>Elektrik</option>
    <option>SteuergerÃ¤te</option>
    <option>Fahrwerk</option>
    <option>Bremsen</option>
    <option>Karosserie auÃŸen</option>
    <option>Innenraum</option>
    <option>Beleuchtung</option>
    <option>Antrieb</option>
  </select>

  <h3>Teil hinzufÃ¼gen</h3>
  <input id="newName" placeholder="Teilname">
  <input id="newCategory" placeholder="Kategorie">
  <input id="newOem" placeholder="OEM Nummer">
  <input id="newDesc" placeholder="Beschreibung">
  <button onclick="addPart()">HinzufÃ¼gen</button>

  <div id="list"></div>

</div>

<script>
const defaultParts = [
  {name:"Zylinderkopf", category:"Motor", oem:"11127806100", desc:"M57 Diesel Zylinderkopf"},
  {name:"Turbolader", category:"Motor", oem:"11657802588", desc:"Abgasturbolader"},
  {name:"Wasserpumpe", category:"KÃ¼hlsystem", oem:"11517788826", desc:"KÃ¼hlmittelpumpe"},
  {name:"Bremscheibe VA", category:"Bremsen", oem:"34116864058", desc:"BelÃ¼ftete Bremsscheibe vorne"},
  {name:"Injektor", category:"Kraftstoffsystem", oem:"13537805430", desc:"Common-Rail Injektor"},
  {name:"Kardanwelle", category:"Antrieb", oem:"26107570956", desc:"xDrive Kardanwelle"},
  {name:"Motorhaube", category:"Karosserie auÃŸen", oem:"41617111385", desc:"Motorhaube Touring"},
  {name:"KotflÃ¼gel", category:"Karosserie auÃŸen", oem:"41357133241", desc:"KotflÃ¼gel vorne links"},
  {name:"TÃ¼r vorne links", category:"Karosserie auÃŸen", oem:"41517202015", desc:"VordertÃ¼r links"},
  {name:"Heckklappe", category:"Karosserie auÃŸen", oem:"41627111391", desc:"Heckklappe Touring"},
  {name:"Scheinwerfer", category:"Beleuchtung", oem:"63117181293", desc:"Xenon Scheinwerfer links"},
  {name:"RÃ¼cklicht", category:"Beleuchtung", oem:"63217181297", desc:"RÃ¼ckleuchte rechts"},
  {name:"Sitz", category:"Innenraum", oem:"52107188367", desc:"Komfortsitz Fahrer"},
  {name:"Getriebe", category:"Getriebe", oem:"24007571213", desc:"6HP Automatikgetriebe"},
  {name:"DME SteuergerÃ¤t", category:"SteuergerÃ¤te", oem:"12147588817", desc:"MotorsteuergerÃ¤t"},
  {name:"StoÃŸstange vorne", category:"Karosserie auÃŸen", oem:"51117184735", desc:"FrontstoÃŸstange"},
  {name:"StoÃŸstange hinten", category:"Karosserie auÃŸen", oem:"51127184736", desc:"HeckstoÃŸstange"},
  {name:"Batterie", category:"Elektrik", oem:"61217586967", desc:"Starterbatterie AGM"},
  {name:"Lichtmaschine", category:"Elektrik", oem:"12317802588", desc:"Generator"},
  {name:"Anlasser", category:"Elektrik", oem:"12417802589", desc:"Startermotor"},
  {name:"AGR Ventil", category:"Abgasanlage", oem:"11717804384", desc:"AbgasrÃ¼ckfÃ¼hrventil"},
  {name:"DPF", category:"Abgasanlage", oem:"18307798164", desc:"Dieselpartikelfilter"},
  {name:"Querlenker", category:"Fahrwerk", oem:"31126769797", desc:"Querlenker vorne"},
  {name:"StoÃŸdÃ¤mpfer", category:"Fahrwerk", oem:"33526771726", desc:"StoÃŸdÃ¤mpfer hinten"},
  {name:"Differential", category:"Antrieb", oem:"33107573287", desc:"Hinterachsdifferential"},
  {name:"Lenkgetriebe", category:"Fahrwerk", oem:"32106786117", desc:"Servolenkung"},
  {name:"Klimakompressor", category:"KÃ¼hlsystem", oem:"64529165808", desc:"Klimakompressor"}
];

let parts = JSON.parse(localStorage.getItem("parts") || "[]");

// ðŸ”§ ErgÃ¤nze fehlende Default-Teile
defaultParts.forEach(dp => {
  if (!parts.find(p => p.name === dp.name)) {
    parts.push(dp);
  }
});

// ðŸ”§ Repariere alte Teile
parts = parts.map(p => ({
  name: p.name,
  category: p.category || "Unbekannt",
  oem: p.oem || "",
  desc: p.desc || "â€“ nicht hinterlegt â€“"
}));

localStorage.setItem("parts", JSON.stringify(parts));

// â­ Favoriten
let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

// ðŸš— VIN
let vin = localStorage.getItem("vin") || "";
document.getElementById("vinInput").value = vin;
document.getElementById("vinInput").oninput = () => {
  localStorage.setItem("vin", document.getElementById("vinInput").value);
};

function render() {
  let search = document.getElementById("search").value.toLowerCase();
  let cat = document.getElementById("categoryFilter").value;
  let list = document.getElementById("list");
  list.innerHTML = "";

  parts.filter(p => 
    (!cat || p.category === cat) &&
    (p.name.toLowerCase().includes(search) ||
     (p.oem || "").includes(search) ||
     (p.desc || "").toLowerCase().includes(search))
  ).forEach((p, i) => {

    let fav = favorites.includes(p.oem || p.name);

    let div = document.createElement("div");
    div.className = "part";
    div.innerHTML = `
      <b>${p.name}</b>
      <small>${p.category}</small>
      <span class="star" onclick="toggleFav('${p.oem || p.name}', event)">${fav ? "â˜…" : "â˜†"}</span>
      <div class="details" id="d${i}">
        <b>OEM:</b> ${p.oem || "â€“ nicht hinterlegt â€“"}<br>
        <b>Beschreibung:</b> ${p.desc || "â€“ nicht hinterlegt â€“"}
      </div>
    `;

    div.onclick = () => {
      let d = document.getElementById("d" + i);
      d.style.display = d.style.display === "block" ? "none" : "block";
    };

    list.appendChild(div);
  });
}

function toggleFav(id, event) {
  event.stopPropagation();
  if (favorites.includes(id))
    favorites = favorites.filter(f => f !== id);
  else favorites.push(id);

  localStorage.setItem("favorites", JSON.stringify(favorites));
  render();
}

function addPart() {
  let n = document.getElementById("newName").value.trim();
  let c = document.getElementById("newCategory").value.trim();
  let o = document.getElementById("newOem").value.trim();
  let d = document.getElementById("newDesc").value.trim();

  if (!n || !c) return alert("Mindestens Name und Kategorie angeben");

  parts.push({
    name: n,
    category: c,
    oem: o || "",
    desc: d || "â€“ nicht hinterlegt â€“"
  });

  localStorage.setItem("parts", JSON.stringify(parts));

  document.getElementById("newName").value = "";
  document.getElementById("newCategory").value = "";
  document.getElementById("newOem").value = "";
  document.getElementById("newDesc").value = "";

  render();
}

document.getElementById("search").oninput = render;
document.getElementById("categoryFilter").onchange = render;

render();
</script>

</body>
</html>
