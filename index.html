<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>BMW E61 Teileliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: #f2f2f7;
      margin: 0;
    }

    header {
      background: #111;
      color: white;
      padding: 20px;
      text-align: center;
    }

    .container {
      padding: 15px;
      max-width: 700px;
      margin: auto;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      font-weight: 600;
    }

    button.secondary {
      background: #6b7280;
    }

    .part {
      background: #3b82f6;
      color: white;
      padding: 14px;
      border-radius: 14px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .part h3 {
      margin: 0;
      font-size: 18px;
    }

    .part small {
      opacity: 0.9;
      display: block;
    }

    .star {
      font-size: 18px;
      color: gold;
      cursor: pointer;
      margin-right: 10px;
    }

    .info-box {
      background: white;
      border-left: 5px solid #3b82f6;
      padding: 12px;
      border-radius: 10px;
      margin-top: 10px;
    }

    .hidden {
      display: none;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row > * {
      flex: 1;
    }
  </style>
</head>
<body>

<header>
  <h1>BMW E61 Teileliste</h1>
  <p>Suche, filtere oder füge neue Teile hinzu</p>
</header>

<div class="container">

  <!-- VIN -->
  <input id="vinInput" placeholder="FIN / VIN eingeben">
  <button onclick="saveVIN()">VIN speichern</button>

  <!-- Suche -->
  <input id="searchInput" placeholder="Teil suchen..." oninput="renderParts()">

  <!-- Kategorie -->
  <select id="categoryFilter" onchange="renderParts()">
    <option value="Alle">Alle Kategorien</option>
  </select>

  <!-- OEM Import -->
  <h3>OEM-Nummern per FIN importieren</h3>
  <textarea id="oemImport" rows="4" placeholder="Format:
Zylinderkopf;11127806100
Turbolader;11657802588"></textarea>
  <button onclick="importOEMs()">OEMs importieren</button>

  <!-- Teil hinzufügen -->
  <h3>Teil hinzufügen</h3>
  <input id="newName" placeholder="Teilname">
  <input id="newCategory" placeholder="Kategorie">
  <input id="newOEM" placeholder="OEM Nummer">
  <textarea id="newDesc" placeholder="Beschreibung"></textarea>
  <button onclick="addPart()">Hinzufügen</button>

  <!-- Liste -->
  <div id="partsList"></div>

</div>

<script>
let vin = localStorage.getItem("vin") || "";
document.getElementById("vinInput").value = vin;

let defaultParts = [
  {name:"Zylinderkopf", category:"Motor", oem:"", desc:"M57 Diesel Zylinderkopf"},
  {name:"Turbolader", category:"Motor", oem:"", desc:"Abgasturbolader"},
  {name:"Injektor", category:"Motor", oem:"", desc:"Common-Rail Injektor"},
  {name:"Hochdruckpumpe", category:"Motor", oem:"", desc:"Kraftstoff Hochdruckpumpe"},
  {name:"Wasserpumpe", category:"Kühlsystem", oem:"", desc:"Kühlmittelpumpe"},
  {name:"Thermostat", category:"Kühlsystem", oem:"", desc:"Motorthermostat"},
  {name:"Getriebe", category:"Getriebe", oem:"", desc:"Automatikgetriebe"},
  {name:"Kupplung", category:"Getriebe", oem:"", desc:"Kupplungseinheit"},
  {name:"Kardanwelle", category:"Antrieb", oem:"", desc:"xDrive Kardanwelle"},
  {name:"Differenzial", category:"Antrieb", oem:"", desc:"Hinterachsdifferenzial"},
  {name:"Bremsscheibe VA", category:"Bremsen", oem:"", desc:"Belüftete Bremsscheibe vorne"},
  {name:"Bremssattel", category:"Bremsen", oem:"", desc:"Vorderer Bremssattel"},
  {name:"ABS Steuergerät", category:"Elektronik", oem:"", desc:"ABS/DSC Modul"},
  {name:"Motorsteuergerät", category:"Elektronik", oem:"", desc:"DDE Steuergerät"},
  {name:"Kombiinstrument", category:"Elektronik", oem:"", desc:"Tacho"},
  {name:"Scheinwerfer", category:"Beleuchtung", oem:"", desc:"Frontscheinwerfer"},
  {name:"Rücklicht", category:"Beleuchtung", oem:"", desc:"Rückleuchte"},
  {name:"Batterie", category:"Elektrik", oem:"", desc:"Starterbatterie"},
  {name:"Kotflügel", category:"Karosserie außen", oem:"", desc:"Vorderer Kotflügel"},
  {name:"Motorhaube", category:"Karosserie außen", oem:"", desc:"Haube"},
  {name:"Tür vorne links", category:"Karosserie außen", oem:"", desc:"Fahrertür"},
  {name:"Heckklappe", category:"Karosserie außen", oem:"", desc:"Kofferraumklappe"},
  {name:"Stoßstange vorne", category:"Karosserie außen", oem:"", desc:"Frontstoßstange"},
  {name:"Sitz", category:"Innenraum", oem:"", desc:"Vordersitz"},
  {name:"Lenkrad", category:"Innenraum", oem:"", desc:"Multifunktionslenkrad"},
  {name:"Klimabedienteil", category:"Innenraum", oem:"", desc:"Klimasteuerung"}
];

let parts = [];

function loadParts() {
  let key = "parts_" + vin;
  let saved = localStorage.getItem(key);
  parts = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultParts));
  updateCategories();
  renderParts();
}

function saveParts() {
  if (!vin) return;
  localStorage.setItem("parts_" + vin, JSON.stringify(parts));
}

function saveVIN() {
  vin = document.getElementById("vinInput").value.trim();
  if (!vin) return alert("Bitte VIN eingeben");
  localStorage.setItem("vin", vin);
  loadParts();
}

function updateCategories() {
  let select = document.getElementById("categoryFilter");
  let cats = [...new Set(parts.map(p => p.category))];
  select.innerHTML = '<option value="Alle">Alle Kategorien</option>';
  cats.forEach(c => {
    let opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });
}

function renderParts() {
  let list = document.getElementById("partsList");
  list.innerHTML = "";

  let q = document.getElementById("searchInput").value.toLowerCase();
  let cat = document.getElementById("categoryFilter").value;

  parts
    .filter(p => 
      (p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q)) &&
      (cat === "Alle" || p.category === cat)
    )
    .forEach((p, i) => {
      let div = document.createElement("div");
      div.className = "part";
      div.innerHTML = `
        <div onclick="toggleInfo(${i})">
          <h3>${p.name}</h3>
          <small>${p.category}</small>
          <small>Status: ${p.status || "undefined"}</small>
        </div>
        <div>
          <span class="star" onclick="toggleFav(${i}, event)">★</span>
        </div>
      `;

      let info = document.createElement("div");
      info.className = "info-box hidden";
      info.id = "info_" + i;
      info.innerHTML = `
        <strong>OEM:</strong> ${p.oem || "-"}<br>
        <strong>Beschreibung:</strong> ${p.desc || "-"}
      `;

      list.appendChild(div);
      list.appendChild(info);
    });
}

function toggleInfo(i) {
  let box = document.getElementById("info_" + i);
  box.classList.toggle("hidden");
}

function toggleFav(i, e) {
  e.stopPropagation();
  parts[i].fav = !parts[i].fav;
  saveParts();
}

function addPart() {
  let n = newName.value.trim();
  let c = newCategory.value.trim();
  let o = newOEM.value.trim();
  let d = newDesc.value.trim();
  if (!n || !c) return alert("Name & Kategorie nötig");

  parts.push({name:n, category:c, oem:o, desc:d});
  saveParts();
  updateCategories();
  renderParts();

  newName.value = "";
  newCategory.value = "";
  newOEM.value = "";
  newDesc.value = "";
}

function importOEMs() {
  let lines = document.getElementById("oemImport").value.split("\n");
  lines.forEach(l => {
    let [name, oem] = l.split(";");
    if (!name || !oem) return;
    let p = parts.find(x => x.name.toLowerCase() === name.toLowerCase());
    if (p) p.oem = oem.trim();
  });
  saveParts();
  renderParts();
}

if (vin) loadParts();
</script>

</body>
</html>
