<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>BMW E61 Teileliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin-bottom: 10px;
      font-size: 16px;
    }

    button {
      background: #3b82f6;
      color: white;
      font-weight: bold;
    }

    .part {
      background: #3b82f6;
      border-radius: 18px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }

    .part h3 {
      margin: 0;
      font-size: 20px;
    }

    .part p {
      margin: 4px 0 0 0;
      opacity: 0.85;
    }

    .delete-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 10px;
      width: 44px;
      height: 44px;
      font-size: 20px;
    }

    .info-box {
      background: #fff;
      color: #000;
      border-left: 6px solid #3b82f6;
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<h1>Teileliste</h1>

<input id="vinInput" placeholder="FIN eingeben (z.B. WBAPY51000CX14466)">

<input id="searchInput" placeholder="Teil suchen...">

<select id="categoryFilter">
  <option value="">Alle Kategorien</option>
</select>

<h2>Teil hinzufügen</h2>

<input id="nameInput" placeholder="Teilname">
<input id="categoryInput" placeholder="Kategorie">
<input id="oemInput" placeholder="OEM Nummer">
<textarea id="descInput" placeholder="Beschreibung"></textarea>
<button onclick="addPart()">Hinzufügen</button>

<div id="partsList"></div>

<script>
let data = JSON.parse(localStorage.getItem("bmw_data")) || {};
let currentVin = "";

const vinInput = document.getElementById("vinInput");
const searchInput = document.getElementById("searchInput");
const categoryFilter = document.getElementById("categoryFilter");
const partsList = document.getElementById("partsList");

vinInput.addEventListener("change", () => {
  currentVin = vinInput.value.trim();
  loadVin();
});

searchInput.addEventListener("input", renderParts);
categoryFilter.addEventListener("change", renderParts);

function loadVin() {
  if (!currentVin) return;

  if (!data[currentVin]) {
    data[currentVin] = [];
  }

  localStorage.setItem("bmw_vin", currentVin);
  localStorage.setItem("bmw_data", JSON.stringify(data));

  renderParts();
  updateCategoryFilter();
}

function addPart() {
  if (!currentVin) {
    alert("Bitte zuerst eine FIN eingeben.");
    return;
  }

  const name = nameInput.value.trim();
  const category = categoryInput.value.trim();
  const oem = oemInput.value.trim();
  const desc = descInput.value.trim();

  if (!name || !category) {
    alert("Teilname und Kategorie sind Pflicht.");
    return;
  }

  const parts = data[currentVin];

  if (parts.some(p => p.name.toLowerCase() === name.toLowerCase())) {
    alert("Dieses Teil existiert bereits.");
    return;
  }

  parts.push({ name, category, oem, desc });
  saveData();

  nameInput.value = "";
  categoryInput.value = "";
  oemInput.value = "";
  descInput.value = "";

  renderParts();
  updateCategoryFilter();
}

function deletePart(index) {
  data[currentVin].splice(index, 1);
  saveData();
  renderParts();
}

function renderParts() {
  if (!currentVin) return;

  const parts = data[currentVin];
  const search = searchInput.value.toLowerCase();
  const category = categoryFilter.value;

  partsList.innerHTML = "";

  parts.forEach((part, index) => {
    if (
      part.name.toLowerCase().includes(search) &&
      (category === "" || part.category === category)
    ) {
      const div = document.createElement("div");
      div.className = "part";

      div.innerHTML = `
        <h3>${part.name}</h3>
        <p>${part.category}</p>
        <button class="delete-btn" onclick="deletePart(${index})">✖</button>
      `;

      div.addEventListener("click", (e) => {
        if (e.target.classList.contains("delete-btn")) return;

        const existing = div.querySelector(".info-box");
        if (existing) {
          existing.remove();
        } else {
          const info = document.createElement("div");
          info.className = "info-box";
          info.innerHTML = `
            <strong>Name:</strong> ${part.name}<br>
            <strong>Kategorie:</strong> ${part.category}<br>
            <strong>OEM:</strong> ${part.oem || "-"}<br>
            <strong>Beschreibung:</strong> ${part.desc || "-"}
          `;
          div.appendChild(info);
        }
      });

      partsList.appendChild(div);
    }
  });
}

function updateCategoryFilter() {
  if (!currentVin) return;

  const parts = data[currentVin];
  const categories = [...new Set(parts.map(p => p.category))];

  categoryFilter.innerHTML = `<option value="">Alle Kategorien</option>`;

  categories.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    categoryFilter.appendChild(opt);
  });
}

function saveData() {
  localStorage.setItem("bmw_data", JSON.stringify(data));
}

(function init() {
  const savedVin = localStorage.getItem("bmw_vin");
  if (savedVin) {
    vinInput.value = savedVin;
    currentVin = savedVin;
    loadVin();
  }
})();
</script>

</body>
</html>
