<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BMW E61 525xd ‚Äì Teileliste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
  color: #000;
}

.dark body {
  background: #111;
  color: #eee;
}

header {
  background: #111;
  color: #fff;
  padding: 20px;
  text-align: center;
}

.dark header {
  background: #000;
}

#controls, #panel, #addForm {
  background: #fff;
  margin: 10px;
  padding: 10px;
  border-radius: 10px;
}

.dark #controls, 
.dark #panel, 
.dark #addForm {
  background: #1f1f1f;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  background: #3b82f6;
  color: white;
  border: none;
}

button.star {
  background: #facc15;
  color: black;
}

button.ok { background:#22c55e; }
button.bad { background:#ef4444; }
button.warn { background:#f59e0b; }

.item {
  background: #3b82f6;
  color: #fff;
  padding: 12px;
  border-radius: 10px;
  margin: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.item span {
  font-size: 16px;
}

.status {
  font-size: 12px;
  opacity: 0.9;
}
</style>
</head>
<body id="app">

<header>
  <h1>BMW E61 525xd ‚Äì Teileliste</h1>
  <p>Tippe auf ein Teil</p>
</header>

<div id="controls">
  <input id="search" placeholder="Suche nach Name, OEM oder Gruppe" oninput="renderList()">

  <select id="groupFilter" onchange="renderList()">
    <option value="">Alle Gruppen</option>
  </select>

  <button onclick="showFavorites()">‚≠ê Favoriten</button>
  <button onclick="toggleDark()">üåô Dark Mode</button>
</div>

<div id="list"></div>

<div id="panel">
  Tippe auf ein Teil
</div>

<div id="addForm">
  <h3>‚ûï Neues Teil</h3>
  <input id="newName" placeholder="Name">
  <input id="newOEM" placeholder="OEM">
  <input id="newGroup" placeholder="Gruppe">
  <input id="newDesc" placeholder="Beschreibung">
  <button onclick="addPart()">Hinzuf√ºgen</button>
</div>

<script>
let parts = [
  {name:"Zylinderkopf", oem:"11127806100", group:"Motor", desc:"M57 Diesel Zylinderkopf", status:"OK", note:""},
  {name:"Turbolader", oem:"11657802588", group:"Turbo", desc:"Abgasturbolader", status:"OK", note:""},
  {name:"Wasserpumpe", oem:"11517788826", group:"K√ºhlsystem", desc:"K√ºhlmittelpumpe", status:"OK", note:""},
  {name:"Bremsscheibe VA", oem:"34116864058", group:"Bremsen", desc:"Bel√ºftete Bremsscheibe vorne", status:"OK", note:""},
  {name:"Injektor", oem:"13537805430", group:"Kraftstoff", desc:"Common-Rail Injektor", status:"OK", note:""},
  {name:"Kardanwelle", oem:"26107570956", group:"Antrieb", desc:"xDrive Kardanwelle", status:"OK", note:""},
  {name:"R√ºcklicht", oem:"63217160793", group:"Karosserie", desc:"R√ºckleuchte rechts", status:"OK", note:""},
  {name:"Batterie", oem:"61217586967", group:"Elektrik", desc:"Starterbatterie", status:"OK", note:""}
];

let favorites = [];

function save() {
  localStorage.setItem("parts", JSON.stringify(parts));
  localStorage.setItem("favorites", JSON.stringify(favorites));
  localStorage.setItem("dark", document.body.classList.contains("dark"));
}

function load() {
  let p = localStorage.getItem("parts");
  let f = localStorage.getItem("favorites");
  let d = localStorage.getItem("dark");

  if (p) parts = JSON.parse(p);
  if (f) favorites = JSON.parse(f);
  if (d === "true") document.body.classList.add("dark");
}

function renderGroups() {
  let groups = [...new Set(parts.map(p => p.group))];
  let sel = document.getElementById("groupFilter");
  sel.innerHTML = '<option value="">Alle Gruppen</option>';
  groups.forEach(g => {
    let opt = document.createElement("option");
    opt.value = g;
    opt.textContent = g;
    sel.appendChild(opt);
  });
}

function renderList(list = parts) {
  let search = document.getElementById("search").value.toLowerCase();
  let group = document.getElementById("groupFilter").value;

  let filtered = list.filter(p =>
    (!search || p.name.toLowerCase().includes(search) || p.oem.includes(search) || p.group.toLowerCase().includes(search)) &&
    (!group || p.group === group)
  );

  let container = document.getElementById("list");
  container.innerHTML = "";

  filtered.forEach(p => {
    let div = document.createElement("div");
    div.className = "item";

    let span = document.createElement("span");
    span.innerHTML = p.name + "<br><span class='status'>Status: " + p.status + "</span>";
    span.onclick = () => show(p);

    let star = document.createElement("button");
    star.className = "star";
    star.textContent = favorites.includes(p.oem) ? "‚òÖ" : "‚òÜ";
    star.onclick = () => toggleFavorite(p.oem);

    div.appendChild(span);
    div.appendChild(star);
    container.appendChild(div);
  });
}

function show(p) {
  document.getElementById("panel").innerHTML =
    "<strong>Name:</strong> " + p.name + "<br>" +
    "<strong>OEM:</strong> " + p.oem + "<br>" +
    "<strong>Gruppe:</strong> " + p.group + "<br>" +
    "<strong>Beschreibung:</strong> " + p.desc + "<br>" +
    "<strong>Status:</strong> " + p.status + "<br>" +
    "<strong>Notiz:</strong><br><textarea id='noteBox'>" + (p.note || "") + "</textarea>" +
    "<button class='ok' onclick=\"setStatus('" + p.oem + "','OK')\">OK</button> " +
    "<button class='warn' onclick=\"setStatus('" + p.oem + "','Beobachten')\">Beobachten</button> " +
    "<button class='bad' onclick=\"setStatus('" + p.oem + "','Defekt')\">Defekt</button> " +
    "<button onclick=\"saveNote('" + p.oem + "')\">Notiz speichern</button>";
}

function addPart() {
  let name = newName.value;
  let oem = newOEM.value;
  let group = newGroup.value;
  let desc = newDesc.value;

  if (!name || !oem) return alert("Name und OEM sind Pflicht");

  parts.push({name, oem, group, desc, status:"OK", note:""});
  save();
  renderGroups();
  renderList();

  newName.value = newOEM.value = newGroup.value = newDesc.value = "";
}

function toggleFavorite(oem) {
  if (favorites.includes(oem)) {
    favorites = favorites.filter(f => f !== oem);
  } else {
    favorites.push(oem);
  }
  save();
  renderList();
}

function showFavorites() {
  let favParts = parts.filter(p => favorites.includes(p.oem));
  renderList(favParts);
}

function setStatus(oem, status) {
  let p = parts.find(x => x.oem === oem);
  p.status = status;
  save();
  renderList();
  show(p);
}

function saveNote(oem) {
  let p = parts.find(x => x.oem === oem);
  p.note = document.getElementById("noteBox").value;
  save();
  alert("Notiz gespeichert");
}

function toggleDark() {
  document.body.classList.toggle("dark");
  save();
}

load();
renderGroups();
renderList();
</script>

</body>
</html>
