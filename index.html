<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BMW Teileliste</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .box {
      background: #111;
      color: #fff;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin: 6px 0;
      box-sizing: border-box;
      font-size: 16px;
    }

    button {
      background: #3b82f6;
      color: #fff;
      border: none;
      font-weight: bold;
    }

    button:hover {
      background: #2563eb;
    }

    .part-card {
      background: #3b82f6;
      color: #fff;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
    }

    .part-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .part-title {
      font-size: 18px;
      font-weight: bold;
    }

    .part-category {
      font-size: 14px;
      opacity: 0.9;
    }

    .delete-btn {
      background: #e11d48;
      border: none;
      color: #fff;
      border-radius: 8px;
      padding: 6px 10px;
      font-weight: bold;
      font-size: 16px;
    }

    .info-box {
      background: #fff;
      color: #000;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>

<body>

<h1>BMW Teileliste</h1>

<div class="box">
  <select id="vehicleSelect"></select>
  <input id="vinInput" placeholder="FIN" />
  <input id="nameInput" placeholder="Anzeigename (z. B. E61 Daily)" />
  <button onclick="addVehicle()">Fahrzeug hinzufügen</button>
</div>

<input id="searchInput" placeholder="Teil suchen..." oninput="renderParts()" />
<select id="categoryFilter" onchange="renderParts()">
  <option value="">Alle Kategorien</option>
</select>

<h3>Teil hinzufügen</h3>
<input id="partName" placeholder="Teilname" />
<input id="partCategory" placeholder="Kategorie" />
<input id="partOEM" placeholder="OEM Nummer" />
<textarea id="partDesc" placeholder="Beschreibung"></textarea>
<button onclick="addPart()">Hinzufügen</button>

<div id="partsList"></div>

<script>
let data = JSON.parse(localStorage.getItem("bmwData")) || { vehicles: {} };
let currentVIN = null;

function saveData() {
  localStorage.setItem("bmwData", JSON.stringify(data));
}

function addVehicle() {
  const vin = vinInput.value.trim();
  const name = nameInput.value.trim();

  if (!vin || !name) {
    alert("FIN und Anzeigename ausfüllen!");
    return;
  }

  if (!data.vehicles[vin]) {
    data.vehicles[vin] = {
      name,
      parts: []
    };
    saveData();
  }

  vinInput.value = "";
  nameInput.value = "";

  currentVIN = vin;
  renderVehicles();
  renderParts();
}

function renderVehicles() {
  vehicleSelect.innerHTML = "";

  Object.entries(data.vehicles).forEach(([vin, v]) => {
    const opt = document.createElement("option");
    opt.value = vin;
    opt.textContent = `${v.name} (${vin})`;
    vehicleSelect.appendChild(opt);
  });

  if (currentVIN) {
    vehicleSelect.value = currentVIN;
  }

  vehicleSelect.onchange = () => {
    currentVIN = vehicleSelect.value;
    renderParts();
  };
}

function addPart() {
  if (!currentVIN) {
    alert("Bitte zuerst ein Fahrzeug auswählen!");
    return;
  }

  const name = partName.value.trim();
  const category = partCategory.value.trim();
  const oem = partOEM.value.trim();
  const desc = partDesc.value.trim();

  if (!name || !category) {
    alert("Teilname und Kategorie ausfüllen!");
    return;
  }

  data.vehicles[currentVIN].parts.push({
    name,
    category,
    oem,
    desc
  });

  saveData();

  partName.value = "";
  partCategory.value = "";
  partOEM.value = "";
  partDesc.value = "";

  renderParts();
}

function deletePart(index) {
  if (!currentVIN) return;

  data.vehicles[currentVIN].parts.splice(index, 1);
  saveData();
  renderParts();
}

function renderParts() {
  partsList.innerHTML = "";
  categoryFilter.innerHTML = `<option value="">Alle Kategorien</option>`;

  if (!currentVIN || !data.vehicles[currentVIN]) return;

  const parts = data.vehicles[currentVIN].parts;
  const search = searchInput.value.toLowerCase();
  const filterCat = categoryFilter.value;

  const categories = [...new Set(parts.map(p => p.category))];
  categories.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    categoryFilter.appendChild(opt);
  });

  parts.forEach((p, i) => {
    if (
      (search && !p.name.toLowerCase().includes(search)) ||
      (filterCat && p.category !== filterCat)
    ) return;

    const card = document.createElement("div");
    card.className = "part-card";

    const header = document.createElement("div");
    header.className = "part-header";

    const left = document.createElement("div");

    const title = document.createElement("div");
    title.className = "part-title";
    title.textContent = p.name;

    const cat = document.createElement("div");
    cat.className = "part-category";
    cat.textContent = p.category;

    left.appendChild(title);
    left.appendChild(cat);

    const del = document.createElement("button");
    del.className = "delete-btn";
    del.textContent = "X";
    del.onclick = e => {
      e.stopPropagation();
      deletePart(i);
    };

    header.appendChild(left);
    header.appendChild(del);

    const info = document.createElement("div");
    info.className = "info-box";
    info.innerHTML = `
      <b>OEM:</b> ${p.oem || "-"}<br>
      <b>Beschreibung:</b> ${p.desc || "-"}
    `;
    info.style.display = "none";

    card.onclick = () => {
      info.style.display = info.style.display === "none" ? "block" : "none";
    };

    card.appendChild(header);
    card.appendChild(info);
    partsList.appendChild(card);
  });
}

renderVehicles();
</script>

</body>
</html>
