<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BMW E61 Teileliste</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  background: #f2f2f7;
  margin: 0;
}

header {
  background: #111;
  color: white;
  padding: 20px;
  text-align: center;
}

.container {
  padding: 15px;
  max-width: 700px;
  margin: auto;
}

input, select, textarea, button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 16px;
}

button {
  background: #3b82f6;
  color: white;
  border: none;
  cursor: pointer;
}

button.secondary {
  background: #888;
}

button.danger {
  background: #e11d48;
}

.part {
  background: #3b82f6;
  color: white;
  border-radius: 15px;
  padding: 15px;
  margin: 10px 0;
  position: relative;
}

.part small {
  opacity: 0.85;
}

.star {
  position: absolute;
  right: 45px;
  top: 15px;
  font-size: 20px;
  color: gold;
  cursor: pointer;
}

.delete-btn {
  position: absolute;
  right: 10px;
  top: 12px;
  font-size: 18px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
}

.panel {
  background: white;
  border-left: 4px solid #3b82f6;
  padding: 12px;
  border-radius: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<header>
  <h1>Teileliste BMW E61</h1>
  <p>Suche, filtere oder füge neue Teile hinzu</p>
</header>

<div class="container">

  <!-- VIN -->
  <input id="vinInput" placeholder="VIN eingeben">

  <!-- Suche -->
  <input id="searchInput" placeholder="Teil suchen..." oninput="renderParts()">

  <!-- Kategorie -->
  <select id="categoryFilter" onchange="renderParts()">
    <option value="">Alle Kategorien</option>
    <option>Motor</option>
    <option>Getriebe</option>
    <option>Kraftstoff</option>
    <option>Abgasanlage</option>
    <option>Kühlsystem</option>
    <option>Bremsen</option>
    <option>Elektrik</option>
    <option>Karosserie außen</option>
    <option>Innenraum</option>
    <option>Beleuchtung</option>
    <option>Steuergeräte</option>
  </select>

  <button class="secondary" onclick="removeDuplicates()">Doppelte Teile entfernen</button>

  <!-- Teil hinzufügen -->
  <h3>Teil hinzufügen</h3>
  <input id="nameInput" placeholder="Teilname">
  <input id="categoryInput" placeholder="Kategorie">
  <input id="oemInput" placeholder="OEM Nummer">
  <textarea id="descInput" placeholder="Beschreibung"></textarea>
  <button onclick="addPart()">Hinzufügen</button>

  <div id="partsList"></div>
  <div id="infoPanel" class="panel" style="display:none;"></div>

</div>

<script>
let vin = localStorage.getItem("vin") || "";
document.getElementById("vinInput").value = vin;

let defaultParts = [
  {name:"Zylinderkopf", category:"Motor", oem:"", desc:"M57 Diesel Zylinderkopf"},
  {name:"Turbolader", category:"Motor", oem:"", desc:"Abgasturbolader"},
  {name:"Injektor", category:"Kraftstoff", oem:"", desc:"Common-Rail Injektor"},
  {name:"Hochdruckpumpe", category:"Kraftstoff", oem:"", desc:"Hochdruckpumpe"},
  {name:"Wasserpumpe", category:"Kühlsystem", oem:"", desc:"Kühlmittelpumpe"},
  {name:"Thermostat", category:"Kühlsystem", oem:"", desc:"Motorthermostat"},
  {name:"Getriebe", category:"Getriebe", oem:"", desc:"Automatikgetriebe"},
  {name:"Kardanwelle", category:"Getriebe", oem:"", desc:"xDrive Kardanwelle"},
  {name:"Differenzial", category:"Getriebe", oem:"", desc:"Hinterachsdifferenzial"},
  {name:"Bremsscheibe VA", category:"Bremsen", oem:"", desc:"Belüftete Bremsscheibe vorne"},
  {name:"Bremssattel", category:"Bremsen", oem:"", desc:"Vorderer Bremssattel"},
  {name:"ABS Steuergerät", category:"Steuergeräte", oem:"", desc:"ABS/DSC Modul"},
  {name:"Motorsteuergerät", category:"Steuergeräte", oem:"", desc:"DDE Steuergerät"},
  {name:"Scheinwerfer", category:"Beleuchtung", oem:"", desc:"Frontscheinwerfer"},
  {name:"Rücklicht", category:"Beleuchtung", oem:"", desc:"Rückleuchte"},
  {name:"Batterie", category:"Elektrik", oem:"", desc:"Starterbatterie"},
  {name:"Kotflügel", category:"Karosserie außen", oem:"", desc:"Vorderer Kotflügel"},
  {name:"Motorhaube", category:"Karosserie außen", oem:"", desc:"Haube"},
  {name:"Tür vorne links", category:"Karosserie außen", oem:"", desc:"Fahrertür"},
  {name:"Heckklappe", category:"Karosserie außen", oem:"", desc:"Kofferraumklappe"},
  {name:"Sitz", category:"Innenraum", oem:"", desc:"Vordersitz"},
  {name:"Lenkrad", category:"Innenraum", oem:"", desc:"Multifunktionslenkrad"}
];

let parts = [];

function loadParts() {
  let key = "parts_" + vin;
  let saved = localStorage.getItem(key);
  parts = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultParts));
  renderParts();
}

function saveParts() {
  if (!vin) return;
  localStorage.setItem("parts_" + vin, JSON.stringify(parts));
}

function saveVIN() {
  vin = document.getElementById("vinInput").value.trim();
  if (!vin) return alert("Bitte VIN eingeben");
  localStorage.setItem("vin", vin);
  loadParts();
}

document.getElementById("vinInput").oninput = saveVIN;

function addPart() {
  const name = nameInput.value.trim();
  const category = categoryInput.value.trim();
  const oem = oemInput.value.trim();
  const desc = descInput.value.trim();

  if (!name || !category) {
    alert("Name und Kategorie sind Pflicht!");
    return;
  }

  // Duplikate verhindern
  const exists = parts.some(p =>
    p.name.toLowerCase() === name.toLowerCase() &&
    p.category.toLowerCase() === category.toLowerCase()
  );

  if (exists) {
    alert("Dieses Teil existiert bereits!");
    return;
  }

  parts.push({name, category, oem, desc});
  saveParts();

  nameInput.value = "";
  categoryInput.value = "";
  oemInput.value = "";
  descInput.value = "";

  renderParts();
}

function deletePart(index, event) {
  event.stopPropagation(); // wichtig für iOS/Safari
  if (!confirm("Teil wirklich löschen?")) return;
  parts.splice(index, 1);
  saveParts();
  renderParts();
  infoPanel.style.display = "none";
}

function removeDuplicates() {
  const seen = {};
  parts = parts.filter(p => {
    const key = p.name.toLowerCase() + "|" + p.category.toLowerCase();
    if (seen[key]) return false;
    seen[key] = true;
    return true;
  });

  saveParts();
  renderParts();
  alert("Doppelte Teile wurden entfernt.");
}

function renderParts() {
  const search = searchInput.value.toLowerCase();
  const category = categoryFilter.value;

  partsList.innerHTML = "";

  parts.forEach((p, i) => {
    if (
      (search && !p.name.toLowerCase().includes(search)) ||
      (category && p.category !== category)
    ) return;

    const div = document.createElement("div");
    div.className = "part";
    div.innerHTML = `
      <strong>${p.name}</strong><br>
      <small>${p.category}</small>
      <button class="delete-btn" onclick="deletePart(${i}, event)">❌</button>
    `;

    div.onclick = () => {
      showInfo(p);
    };

    partsList.appendChild(div);
  });
}

function showInfo(p) {
  infoPanel.style.display = "block";
  infoPanel.innerHTML = `
    <strong>Name:</strong> ${p.name}<br>
    <strong>Kategorie:</strong> ${p.category}<br>
    <strong>OEM:</strong> ${p.oem || "-"}<br>
    <strong>Beschreibung:</strong> ${p.desc || "-"}
  `;
}

if (vin) loadParts();
</script>

</body>
</html>
